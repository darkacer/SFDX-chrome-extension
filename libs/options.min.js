const idToOrgKey=new Map();const idToOrgURL=new Map();var token='';var orgURL='';var purpose='';const serviceData='/services/data'
const version='/v46.0/';var objectList=[];var rowId;var settings={"async":!0,"crossDomain":!0,"url":"https://"+orgURL+ +serviceData+version+purpose,"method":"GET","headers":{"authorization":"Bearer "+token}}
chrome.tabs.onUpdated.addListener(function authorizationHook(tabId,changeInfo,tab){var count=0;chrome.cookies.getAll({"name":"sid"},function(sidcook){$("#table").empty();$("#table").append("<table id='tablefriendsname' border=1></table>");sidcook.forEach(elem=>{var domain=elem.domain;if(new RegExp(".*salesforce\.com").test(domain)){console.log(elem);$("#tablefriendsname").append("<tr><td>"+elem.domain+"</td></tr>");idToOrgKey.set(count,elem.value);idToOrgURL.set(count,elem.domain);count++}});loadEventHandlers()})});function loadEventHandlers(){var SOQLarray=['Select','From','Where','project_cloud__project__c','limit','User','Account'];function split(val){return val.split(/ \s*/)}
function extractLast(term){return split(term).pop()}
$('#query').bind("keydown",function(event){$('.ui-helper-hidden-accessible').empty();if(event.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active){event.preventDefault()}}).autocomplete({minLength:0,source:function(request,response){response($.ui.autocomplete.filter(SOQLarray,extractLast(request.term)))},focus:function(){return!1},select:function(event,ui){var terms=split(this.value);terms.pop();terms.push(ui.item.value);terms.push("");this.value=terms.join(" ");console.log(terms)
console.log(this);return!1}});var table=document.getElementById('table');var cells=table.getElementsByTagName('td');for(var i=0;i<cells.length;i++){var cell=cells[i];cell.onclick=function(){rowId=this.parentNode.rowIndex;token=idToOrgKey.get(rowId);orgURL=idToOrgURL.get(rowId);$("#panel").show();$('#orgName').text(orgURL);console.log(rowId);var rowsNotSelected=table.getElementsByTagName('tr');for(var row=0;row<rowsNotSelected.length;row++){rowsNotSelected[row].style.backgroundColor="";rowsNotSelected[row].classList.remove('selected')}
var rowSelected=table.getElementsByTagName('tr')[rowId];rowSelected.style.backgroundColor="green";rowSelected.className+=" selected"}}
$("#clearData").bind("click",function(){$("#showData").empty();$('#recordDetialTable').empty();$('#objectTable').empty()});$("select").change(function(){var str="";$("select option").each(function(){str+="#"+$(this).text()+","});str=str.substring(0,str.length-1);console.log(str);$(str).hide();str='';$("select option:selected").each(function(){str+=$(this).text()});console.log(str);$('#'+str).show();if(str==='objectDetails'||str==='recordDetails'){var dataList=$(".datalist");dataList.empty();purpose='sobjects/';settings.url="https://"+orgURL+serviceData+version+purpose;settings.headers.authorization="Bearer "+token;fireRest(settings,function(response){objectList=response.sobjects.map(item=>item.name);response.sobjects.forEach(item=>{var option=document.createElement('option');if(!new RegExp("__ChangeEvent|__Tag|__History|__Feed").test(item.name)){option.value=item.name+' ----- '+item.label+' object'}
dataList.append(option)})})}});$("#getObjDetails").bind("click",function(){var val=$('#selectedObj').val();console.log('sdf'+val);var objName=val.split(/-----\s*/);console.log('api name is '+objName[0]);var str=objName[0];str=str.substring(0,str.length-1);purpose="sobjects/"+str+"/describe/";settings.headers.authorization="Bearer "+token;settings.url="https://"+orgURL+serviceData+version+purpose;fireRest(settings,function(response){console.log(response);buildTableAtId('objectTable',response.fields)})})}
$("#sendQuery").bind("click",function(){var query=$('#query').val();query=query.replace(/  /g," ");query=query.replace(/ /g,"+");query=query.replace(/%/g,"%25");var purpose='query/?q='+query;settings.url="https://"+orgURL+serviceData+version+purpose;settings.headers.authorization="Bearer "+token;fireRest(settings,function(response){$("#showData").show();$("#actualData").empty();buildTableAtId('actualData',response.records)})});$("#getRecDetails").bind("click",function(){var recordId=$("#recordId").val();var objectAPIName=$("#selectObj").val().split(/-----\s*/)[0];var givenId='recordDetialTable';purpose='sobjects/'+objectAPIName.substring(0,objectAPIName.length-1)+'/'+recordId;settings.url="https://"+orgURL+serviceData+version+purpose;settings.headers.authorization="Bearer "+token;console.log('setti'+JSON.stringify(settings));fireRest(settings,function(response){var output=Object.entries(response).map(([key,value])=>({key,value}));buildTableAtId(givenId,output)})});function fireRest(settings,callback){$.ajax(settings).done(function(response){callback(response)})}
function buildTableAtId(givenId,rows){console.log(rows);$('#'+givenId).empty();var html='<table border=1>';html+='<tr>';for(var j in rows[0]){html+='<th class="headcol">'+j+'</th>'}
html+='</tr>';for(var i=0;i<rows.length;i++){html+='<tr>';for(var j in rows[i]){html+='<td>'+JSON.stringify(rows[i][j]);+' innn</td>'}
html+='</tr>'}
html+='</table>';$('#'+givenId).html(html)}